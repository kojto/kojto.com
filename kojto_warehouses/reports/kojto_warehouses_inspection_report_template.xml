<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="print_inspection_report">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <div class="page">
                        <t t-set="company_contact" t-value="env['kojto.contacts'].search([('res_company_id', '=', env.company.id)], limit=1)" />
                        <t t-if="company_contact and company_contact.company_logo">
                            <t t-set="company_logo" t-value="'data:image/svg;base64,' + company_contact.company_logo.decode('utf-8')" />
                            <style> @page { @top-right { content: url("<t t-esc='company_logo' />"); width: 80px; vertical-align: bottom; padding-top: 20px; height: 100%; } }</style>
                        </t>
                        <div t-attf-style="string-set: date_issued '{{ o.date_issued.strftime('%Y-%m-%d') if o.date_issued else '' }}';" />
                        <div class="heading" style="margin-bottom: 20px;">
                            <span>INSPECTION REPORT # </span>
                            <span t-field="o.name" />
                        </div>
                        <div class="info-section">
                            <div class="info-cell">
                                <div class="label" style="margin-bottom: 10px;">DETAILS</div>
                                <div t-esc="'Issued on: %s' % o.date_issued" />
                                <div t-esc="'Inspected By: %s' % o.inspected_by.name" />
                                <div t-esc="'Status: %s' % o.status" />
                                <div t-esc="'Manufacturer: %s' % o.counterparty_id.display_name if o.counterparty_id else ''" />
                            </div>
                            <div class="info-cell">
                                <div class="label" style="margin-bottom: 10px;">ISSUED BY</div>
                                <div t-esc="o.company_name_id.display_name if o.company_name_id else ''" />
                                <div t-esc="o.company_address_id.display_name if o.company_address_id else ''" />
                                <div t-esc="o.company_phone_id.display_name if o.company_phone_id else ''" />
                                <div t-esc="o.company_email_id.display_name if o.company_email_id else ''" />
                            </div>
                        </div>

                        <div style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; font-size: 12px;">
                            <span>CHECK LIST</span>
                        </div>
                        <table class="content-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%">#</th>
                                    <th style="width: 25%">Parameter</th>
                                    <th style="text-align: center; width: 15%">Status</th>
                                    <th style="width: 55%">Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Supplier</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.supplier_ok else ''"/></td>
                                    <td><span t-field="o.supplier_note"/></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Material</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.material_ok else ''"/></td>
                                    <td><span t-field="o.material_note"/></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Material Grade</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.material_grade_ok else ''"/></td>
                                    <td><span t-field="o.material_grade_note"/></td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>Quantity</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.quantity_ok else ''"/></td>
                                    <td><span t-field="o.quantity_note"/></td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>Invoice</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.invoice_ok else ''"/></td>
                                    <td><span t-field="o.invoice_note"/></td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <td>Inspection Certificates</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.inspection_certificates_ok else ''"/></td>
                                    <td><span t-field="o.inspection_certificates_note"/></td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <td>Test Reports</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.test_reports_ok else ''"/></td>
                                    <td><span t-field="o.test_reports_note"/></td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td>Declaration</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.declaration_ok else ''"/></td>
                                    <td><span t-field="o.declaration_note"/></td>
                                </tr>
                                <tr>
                                    <td>9</td>
                                    <td>Surface Defects</td>
                                    <td style="text-align: center"><t t-esc="'✓' if o.surface_defects_ok else ''"/></td>
                                    <td><span t-field="o.surface_defects_note"/></td>
                                </tr>
                            </tbody>
                        </table>


                        <div style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; font-size: 12px;">
                            <span>INSPECTION NOTE</span>
                        </div>
                        <div><span t-field="o.notes"/></div>


                        <div style="margin-top: 40px; margin-bottom: 20px; font-weight: bold; font-size: 12px;">
                            <span>INSPECTED ITEMS</span>
                        </div>
                        <div style="height: 10px;" />
                        <table class="content-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Description</th>
                                    <th style="text-align: right" class="ko-w-70">Quantity</th>
                                    <th>Unit</th>
                                    <th style="text-align: right" class="ko-w-70">Weight (kg)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.item_ids" t-as="line">
                                    <tr>
                                        <td><t t-esc="line_index + 1"/></td>
                                        <td><span t-field="line.name"/></td>
                                        <td style="text-align: right">
                                            <t t-set="translated_unit_name" t-value="line.unit_id.translation_ids.filtered(lambda t: t.language_id.code == env.context.get('lang', 'en_US')).name or line.unit_id.name"/>
                                            <t t-esc="'%.2f %s' % (line.current_item_quantity, translated_unit_name) if line.current_item_quantity or line.current_item_quantity == 0 else ''"/>
                                        </td>
                                        <td><span t-field="line.unit_id"/></td>
                                        <td style="text-align: right"><t t-esc="'%.2f' % line.weight if line.weight or line.weight == 0 else ''"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <table style="width: 100%; border-collapse: collapse; margin-top: 40px;">
                            <tr>
                                <th style="width: 50%; text-align: left;">Inspected by:</th>
                                <th style="width: 50%; text-align: left;">Signature</th>
                            </tr>
                            <tr>
                                <td style="border-top: 1px solid #ddd; padding-top: 5px;">
                                    <span t-field="o.inspected_by.name"/>
                                </td>
                                <td style="border-top: 1px solid #ddd; padding-top: 5px;">
                                </td>
                            </tr>
                        </table>

                        <div style="margin-top: 20px; text-align: center;">
                            <p>---- END OF INSPECTION REPORT ----</p>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
