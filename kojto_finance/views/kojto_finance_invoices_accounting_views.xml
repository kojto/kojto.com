<odoo>
    <data>
        <record id="view_kojto_invoices_list_accounting" model="ir.ui.view">
            <field name="name">kojto.finance.invoices.list.accounting</field>
            <field name="model">kojto.finance.invoices</field>
            <field name="arch" type="xml">
                <list class="ko-list-main view_kojto_invoices_list view_kojto_list_invoices_accounting" string="Invoices" default_order="date_issue desc, consecutive_number desc" decoration-warning="not accounting_is_exported">
                    <field name="document_in_out_type" widget="badge" decoration-primary="document_in_out_type == 'outgoing' and active" decoration-info="document_in_out_type == 'incoming' and active" decoration-muted="not active" string=" " />
                    <field name="consecutive_number" string="Document №" decoration-success="accounting_export_date" />
                    <field name="invoice_type" string="Type" />
                    <field name="date_issue" optional="show" string="Issue Date" />
                    <field name="name" string="Ref №" optional="hide" />
                    <field name="counterparty_id" optional="show" />
                    <field name="accounting_op_date" optional="show" string="Acc Date" />
                    <field name="accounting_archive_number" string="Acc Number" />
                    <field name="accountant_id" string="Acc User" />
                    <field name="total_price" optional="show" string="Total Price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="vat_total" optional="show" string="Total VAT" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="currency_id" string="Currency" optional="hide"/>
                    <field name="repr_attachments" optional="show" string="Attachments" widget="badge" decoration-muted="attachments" />
                    <field name="subject" optional="hide" />
                    <field name="locked" widget="boolean_toggle" string="Locked" />
                </list>
            </field>
        </record>

        <record id="view_kojto_invoices_form_accounting" model="ir.ui.view">
            <field name="name">kojto.finance.invoices.form.accounting</field>
            <field name="model">kojto.finance.invoices</field>
            <field name="arch" type="xml">
                <form class="ko-form-main view_kojto_invoices_form">
                    <sheet class="ko-form-body ko-form-accounting-body">
                        <div class="row" >
                            <div class="col-lg-7" style="border-right: 2px solid #ffa500; max-height: 100vh; overflow-y: auto;">
                                <div class="d-flex justify-content-between align-items-center mb-3 ko-form-main-header-line">
                                    <div class="w-100 px-0">
                                        <div class="row no-gutters">
                                            <div class="col-lg-4 me-0 align-items-center">
                                                <div class="ko-form-view-title">
                                                    <span>
                                                        <field name="invoice_type" readonly="1" />
                                                    </span>
                                                    <field name="consecutive_number" readonly="1" class="ko-form-view-title" />
                                                </div>
                                            </div>
                                            <div class="col-lg-7 d-flex align-items-center py-2 py-md-0">
                                                <div class="d-flex align-items-center">
                                                    <field name="document_in_out_type" widget="selection_badge" class="ko-offer-wselection-badge" />
                                                    <div class="border-start border-4 mx-2" style="height: 24px;" />
                                                    <field name="currency_id" widget="selection_badge" class="ko-offer-wselection-badge" />
                                                </div>
                                            </div>
                                            <div class="col-lg-1 d-flex align-items-center justify-content-end py-2 py-md-0">
                                                <button name="export_to_ajur" class="ko-fa fa fa-arrow-circle-down" type="object" title="Export to Ajur" />
                                                <button name="print_document_as_pdf" class="ko-fa fa fa-download" type="object" title="Download PDF" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <separator class="separator-slim-top" />

                                <!-- General Information -->
                                <div class="row">
                                    <group class="col-lg-6">
                                        <field name="invoice_type" string="Type" />
                                        <field name="date_issue" />
                                        <field name="consecutive_number" />
                                        <field name="consecutive_number_selection" string="Available Numbers" />
                                        <field name="subcode_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" />
                                        <field name="invoice_vat_treatment_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" />
                                        <field name="invoice_vat_rate" />
                                        <field name="invoice_acc_template_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" domain="invoice_acc_template_domain" />
                                        <field name="invoice_acc_subtype_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" domain="invoice_acc_subtype_domain" />
                                    </group>
                                    <group class="col-lg-6">
                                        <field name="exchange_rate_to_bgn" />
                                        <field name="exchange_rate_to_eur" />
                                        <field name="parent_invoice_id" invisible="invoice_type in ['invoice', 'proforma']" required="invoice_type in ['credit_note', 'debit_note']" options="{'no_open': True, 'no_create_edit': True, 'no_create': True}" />
                                        <field name="parent_invoice_date_issue" readonly="1" invisible="invoice_type in ['invoice', 'proforma']" required="invoice_type in ['credit_note', 'debit_note']" options="{'no_open': True, 'no_create_edit': True, 'no_create': True}" />
                                        <field name="accounting_archive_number" />
                                        <field name="accounting_op_date" />
                                        <field name="accounting_export_date" decoration-warning="not accounting_is_exported" />
                                    </group>
                                </div>

                                <separator class="col-lg-12 separator" />

                                <div class="row">
                                    <div class="col-lg-6">
                                        <h2 style="font-size: 18px;" label="0" invisible="document_in_out_type != 'outgoing'">From</h2>
                                        <h2 style="font-size: 18px;" label="0" invisible="document_in_out_type != 'incoming'">To</h2>
                                        <group class="col-lg-12">
                                            <field name="company_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" domain="[('res_company_id', '=', company_id)]" />
                                            <field name="company_tax_number_id" domain="[('contact_id', '=', company_id)]" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" />
                                            <field name="company_registration_number" />
                                        </group>
                                    </div>
                                    <div class="col-lg-6 mb-auto" style="margin-bottom: auto">
                                        <h2 style="font-size: 18px;" invisible="document_in_out_type != 'outgoing'">To</h2>
                                        <h2 style="font-size: 18px;" invisible="document_in_out_type != 'incoming'">From</h2>
                                        <group class="col-lg-12">
                                            <field name="counterparty_id" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" />
                                            <field name="counterparty_tax_number_id" domain="[('contact_id', '=', counterparty_id)]" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" />
                                            <div class="o_form_label">Registration Number</div>
                                            <div class="d-flex align-items-center justify-content-start gap-1">
                                                <field name="counterparty_registration_number" class="w-auto mb-0" />
                                                <span>/</span>
                                                <field name="counterparty_type" class="w-auto mb-0" />
                                            </div>
                                        </group>
                                    </div>
                                </div>

                                <separator class="col-lg-12 separator" />

                                <div class="col-lg-12">
                                    <notebook>
                                        <page string="Accounting">
                                            <field name="content" nolabel="1">
                                                <list editable="bottom" class="ko-list-main" default_order="position" create="false">
                                                    <field name="position" readonly="1" width="10" />
                                                    <field name="name" readonly="1" width="100" />
                                                    <field name="vat_treatment_id" domain="[('vat_in_out_type', '=', parent.document_in_out_type)]" placeholder="Select VAT Treatment" options="{'no_create_edit': True, 'no_open': True, 'no_create': True}" width="150" />
                                                    <field name="accounting_template_domain" column_invisible="1" />
                                                    <field name="accounting_template_id" string="Acc Template" domain="accounting_template_domain" width="200" />
                                                    <field name="requires_identifier_id" column_invisible="1" />
                                                    <field name="identifier_id" string="Acc Identifier" readonly="not requires_identifier_id" width="200" />
                                                    <field name="requires_subtype_id" column_invisible="1" />
                                                    <field name="subtype_domain" column_invisible="1" />
                                                    <field name="subtype_id" string="Acc Subtype" readonly="not requires_subtype_id" domain="subtype_domain" width="200" />
                                                    <field name="pre_vat_total" string="Pre VAT" decoration-danger="pre_vat_total &lt; 0" readonly="1" class="fw-bold" />
                                                    <field name="vat_rate" string="VAT %%" width="50" />
                                                    <button type="object" name="auto_accounting" class="fa fa-magic text-primary" title="Auto Accounting" />
                                                </list>
                                            </field>
                                        </page>
                                    </notebook>
                                </div>

                                <separator class="col-lg-12 separator" />

                                <div class="col-lg-12">
                                    <notebook>
                                        <page string="Content">
                                            <field name="content_not_redistribution" nolabel="1">
                                                <list editable="bottom" class="ko-list-main" default_order="position" decoration-danger="is_redistribution">
                                                    <field name="is_redistribution" string="Redistribution" widget="boolean_toggle" default_value="False" readonly="1" optional="hide" />
                                                    <field name="position" />
                                                    <field name="name" />
                                                    <field name="subcode_id" />
                                                    <field name="quantity" />
                                                    <field name="unit_id" options="{'no_open': True}" />
                                                    <field name="unit_price" />
                                                    <field name="pre_vat_total" />
                                                    <field name="vat_total" />
                                                </list>
                                            </field>
                                        </page>
                                        <page string="Redistribution" decoration-danger="invoice_has_invalid_redistribution">
                                            <field name="content_is_redistribution" nolabel="1" context="{'default_is_redistribution': True}">
                                                <list editable="bottom" class="ko-list-main" default_order="position" decoration-danger="not redistribution_is_valid">
                                                    <field name="is_redistribution" string="Redistribution" widget="boolean_toggle" readonly="1" optional="hide" force_save="1" />
                                                    <field name="redistribution_is_valid" string="Valid" widget="boolean_toggle" readonly="1" />
                                                    <field name="position" />
                                                    <field name="name" />
                                                    <field name="subcode_id" />
                                                    <field name="quantity" />
                                                    <field name="unit_id" options="{'no_open': True}" />
                                                    <field name="unit_price" />
                                                    <field name="pre_vat_total" string="Pre-VAT Total" decoration-danger="pre_vat_total &lt; 0" class="fw-bold" />
                                                    <field name="vat_total" />
                                                </list>
                                            </field>
                                        </page>

                                    </notebook>
                                </div>

                                <div class="row">
                                    <group class="col-lg-12 justify-content-end d-flex">
                                        <div>
                                            <!-- Net Price Row -->
                                            <div class="col-lg-9 ms-auto d-flex align-items-center">
                                                <label for="pre_vat_total" class="me-2" />
                                                <field name="pre_vat_total" style="width: 200px" class="text-end" />
                                                <field name="currency_id" style="width: 60px" class="text-start p-1" readonly="1" options="{'no_create_edit': True, 'no_open': True}" />
                                            </div>
                                            <!-- VAT Row -->
                                            <div class="col-lg-9 ms-auto d-flex align-items-center" invisible="custom_vat != 0">
                                                <label for="vat_total" class="me-2" />
                                                <field name="vat_total" style="width: 200px" class="text-end" />
                                                <field name="currency_id" style="width: 60px" class="text-start p-1" readonly="1" options="{'no_create_edit': True, 'no_open': True}" />
                                            </div>
                                            <div class="col-lg-9 ms-auto d-flex align-items-center">
                                                <label for="custom_vat" class="me-2" />
                                                <field name="custom_vat" style="width: 200px" class="text-end" />
                                                <field name="currency_id" style="width: 60px" class="text-start p-1" readonly="1" options="{'no_create_edit': True, 'no_open': True}" />
                                            </div>
                                            <!-- Total Price Row -->
                                            <div class="col-lg-9 ms-auto d-flex align-items-center">
                                                <label for="total_price" class="me-2" />
                                                <field name="total_price" style="width: 200px" class="text-end" />
                                                <field name="currency_id" style="width: 60px" class="text-start p-1" readonly="1" options="{'no_create_edit': True, 'no_open': True}" />
                                            </div>
                                            <div class="col-lg-9 ms-auto mt-4 d-flex">
                                                <field name="total_price_base_currency" string="" style="width: 260px" class="text-start" />
                                            </div>
                                        </div>
                                    </group>
                                </div>

                                <separator class="col-lg-12 separator" />

                                <div class="row">
                                    <group class="col-lg-6">
                                        <div style="">
                                            <field name="attachments" widget="many2many_binary" nolabel="1" class="mt-2" invisible="id == False" />
                                        </div>
                                    </group>
                                    <group class="col-lg-6 d-flex justify-content-end">
                                        <div>
                                            <div class="d-flex align-items-center">
                                                <label for="locked" />
                                                <field name="locked" widget="boolean_toggle" />
                                            </div>

                                            <div class="d-flex align-items-center">
                                                <label for="active" />
                                                <field name="active" optional="show" widget="boolean_toggle" />
                                            </div>
                                        </div>
                                    </group>
                                </div>
                            </div>
                            <div class="col-lg-5" >
                                <field name="attachment_1_outgoing_pdf_bgn" widget="pdf_viewer" invisible="document_in_out_type != 'outgoing'" />
                                <notebook invisible="document_in_out_type != 'incoming'">
                                    <page string="Attachment 1" invisible="not attachments_for_preview">
                                        <field name="attachment_1_incoming_pdf" widget="pdf_viewer" />
                                    </page>
                                    <page string="Attachment 2" invisible="not attachments_for_preview > 1">
                                        <field name="attachment_2_incoming_pdf" widget="pdf_viewer" />
                                    </page>
                                    <page string="Attachment 3" invisible="not attachments_for_preview > 2">
                                        <field name="attachment_3_incoming_pdf" widget="pdf_viewer" />
                                    </page>
                                    <page string="Attachment 4" invisible="not attachments_for_preview > 3">
                                        <field name="attachment_4_incoming_pdf" widget="pdf_viewer" />
                                    </page>
                                    <page string="Attachment 5" invisible="not attachments_for_preview > 4">
                                        <field name="attachment_5_incoming_pdf" widget="pdf_viewer" />
                                    </page>
                                </notebook>
                            </div>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_kojto_finance_invoices_accounting" model="ir.actions.act_window">
            <field name="name">Accounting Invoices</field>
            <field name="res_model">kojto.finance.invoices</field>
            <field name="view_mode">list,form</field>
            <field name="domain" eval="[('invoice_type', 'not in', ['proforma'])]" />
        </record>

        <record id="action_kojto_finance_invoices_accounting_list" model="ir.actions.act_window.view">
            <field eval="1" name="sequence" />
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_kojto_invoices_list_accounting" />
            <field name="act_window_id" ref="action_kojto_finance_invoices_accounting" />
        </record>

        <record id="action_kojto_finance_invoices_accounting_form" model="ir.actions.act_window.view">
            <field eval="2" name="sequence" />
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_kojto_invoices_form_accounting" />
            <field name="act_window_id" ref="action_kojto_finance_invoices_accounting" />
        </record>

        <record id="action_open_wizard_export_invoices_to_ajur" model="ir.actions.server">
            <field name="name">Export Invoices To Ajur</field>
            <field name="model_id" ref="model_kojto_finance_invoices" />
            <field name="binding_model_id" ref="model_kojto_finance_invoices" />
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
                if records:
                    action = {
                        "name": "Kojto Invoices Export To Ajur",
                        "type": "ir.actions.act_window",
                        "res_model": "kojto.finance.invoices.exportselectiontoajur",
                        "view_mode": "form",
                        "target": "new",
                        "context": {
                            "selected_invoices": records.ids,
                        },
                    }
                    result = action
            </field>
        </record>

        <record id="action_open_wizard_export_single_invoice_to_ajur" model="ir.actions.server">
            <field name="name">Export Single Invoice To Ajur</field>
            <field name="model_id" ref="model_kojto_finance_invoices" />
            <field name="binding_model_id" ref="model_kojto_finance_invoices" />
            <field name="binding_view_types">form</field>
            <field name="state">code</field>
            <field name="code">
                if active_id:
                    action = {
                        "name": "Kojto Invoices Export To Ajur",
                        "type": "ir.actions.act_window",
                        "res_model": "kojto.finance.invoices.exportselectiontoajur",
                        "view_mode": "form",
                        "target": "new",
                        "context": {
                            "selected_invoices": [active_id],
                        },
                    }
                    result = action
            </field>
        </record>

        <record id="view_kojto_finance_invoices_export_to_ajur_form" model="ir.ui.view">
            <field name="name">kojto.finance.invoices.exportselectiontoajur.form</field>
            <field name="model">kojto.finance.invoices.exportselectiontoajur</field>
            <field name="arch" type="xml">
                <form string="Export Invoices To Ajur">
                    <group>
                        <field name="acc_op_datetime" />
                    </group>
                    <footer>
                        <button string="Submit" name="action_export_to_ajur" type="object" class="btn-primary" />
                        <button string="Cancel" class="btn-secondary" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>
    </data>
</odoo>
