<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="print_kojto_optimizer_1d_packages">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <div class="page">
                        <t t-set="company_contact" t-value="env['kojto.contacts'].search([('res_company_id', '=', env.company.id)], limit=1)" />
                        <t t-if="company_contact and company_contact.company_logo">
                            <t t-set="company_logo" t-value="'data:image/svg;base64,' + company_contact.company_logo.decode('utf-8')" />
                            <style> @page { @top-right { content: url("<t t-esc='company_logo' />"); width: 80px; vertical-align: bottom; padding-top: 20px; height: 100%; } } </style>
                        </t>

                        <!-- Container 0 -->
                        <div style="font-weight: bold; margin-bottom: 25px; font-size: 16px;">1D OPTIMIZATION PACKAGE</div>

                        <!-- Container 1 (Starting Table, Adjusted) -->
                        <div style="display: flex; align-items: flex-start; gap: 20px; margin-bottom: 10px;">
                            <!-- Table Section -->
                            <div style="flex: 1;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 10px; line-height: 1.2;">
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Package Name</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.name if doc.name else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Subcode</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.subcode_id.display_name if doc.subcode_id else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Issue DateTime</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.date_issue if doc.date_issue else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Issued By</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.issued_by.display_name if doc.issued_by else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Description</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.description if doc.description else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Optimization Method</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="doc.optimization_method if doc.optimization_method else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Width of Cut (mm)</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="'%.2f' % doc.width_of_cut if doc.width_of_cut or doc.width_of_cut == 0 else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Initial Cut (mm)</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="'%.2f' % doc.initial_cut if doc.initial_cut or doc.initial_cut == 0 else ''" />
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; padding: 5px 10px 5px 0;">Final Cut (mm)</th>
                                        <td style="text-align: right; padding: 5px 10px 5px 0;" t-esc="'%.2f' % doc.final_cut if doc.final_cut or doc.final_cut == 0 else ''" />
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Container 2 (Stock Items as Text) -->
                        <div style="margin-bottom: 10px;">
                            <div style="font-weight: bold; margin-bottom: 10px; margin-top: 25px;">STOCK ITEMS</div>
                            <!-- Debug info for stock items -->
                            <div style="margin-bottom: 5px; text-align: left;">
                                <t t-if="doc.stock_ids">
                                    Total Stock Items: <t t-esc="len(doc.stock_ids)"/>
                                </t>
                                <t t-else="">
                                    No stock items available
                                </t>
                            </div>
                            <div style="margin: 0; padding: 0;">
                                <t t-foreach="doc.stock_ids" t-as="stock">
                                    <div style="margin-bottom: 5px;">
                                        <t t-esc="'Pos. %s - %s - %.2f mm - Available: %s' % (stock.stock_position or 'N/A', stock.stock_description or 'N/A', stock.stock_length or 0, stock.available_stock_pieces or 0)"/>
                                    </div>
                                </t>
                            </div>
                        </div>

                        <!-- Container 2a (Required Bars as Text) -->
                        <div style="margin-bottom: 10px;">
                            <div style="font-weight: bold; margin-bottom: 10px; margin-top: 25px;">REQUIRED BARS</div>
                            <!-- Debug info -->
                            <div style="margin-bottom: 5px; text-align: left;">
                                <t t-if="doc.bar_ids">
                                    Total Bars: <t t-esc="len(doc.bar_ids)"/>
                                </t>
                                <t t-else="">
                                    No bars available
                                </t>
                            </div>
                            <div style="margin: 0; padding: 0;">
                                <t t-foreach="doc.bar_ids" t-as="bar">
                                    <div style="margin-bottom: 5px;">
                                        <t t-esc="'Pos. %s - %s - %.2f mm - Required: %s' % (bar.bar_position or 'N/A', bar.bar_description or 'N/A', bar.bar_length or 0, bar.required_bar_pieces or 0)"/>
                                    </div>
                                </t>
                            </div>
                        </div>

                        <!-- Container 3 (Cutting Plan) -->
                        <div>
                            <div style="font-weight: bold; margin-bottom: 10px; margin-top: 25px;">CUTTING PLAN</div>
                            <div style="margin: 0; padding: 0;">
                                <pre style="font-family: Arial;
                                            font-size: 10px;
                                            text-align: left;
                                            line-height: 2;
                                            white-space: pre-wrap;
                                            word-wrap: break-word;
                                            overflow-wrap: break-word;
                                            margin: 0;
                                            padding: 0;"
                                    t-esc="doc.cutting_plan if doc.cutting_plan else 'No cutting plan available'" />
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
